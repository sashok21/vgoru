{# user_profile.html #}
{% extends 'mountains_roads/base.html' %}
{% load static %}

{% block title %}{{ profile_user.get_full_name|default:profile_user.username }} - –ü—Ä–æ—Ñ—ñ–ª—å{% endblock %}

{% block extra_css %}
<style>
    .profile-header {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        padding: 3rem 0;
        margin-bottom: 3rem;
    }
    
    .profile-info {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 2rem;
        align-items: start;
    }
    
    .profile-avatar {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        background: var(--white);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 4rem;
        object-fit: cover;
        border: 5px solid var(--white);
    }
    
    .profile-details h1 {
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }
    
    .profile-details p {
        margin: 0.5rem 0;
        opacity: 0.9;
    }
    
    .profile-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        margin-top: 2rem;
    }
    
    .stat-box {
        background: var(--white);
        padding: 1.5rem;
        border-radius: 10px;
        text-align: center;
        color: var(--dark-gray);
    }
    
    .stat-number {
        font-size: 2rem;
        color: var(--secondary-color);
        font-weight: bold;
    }
    
    .stat-label {
        font-size: 0.9rem;
        color: var(--gray);
    }
    
    .edit-btn {
        margin-top: 1rem;
    }
    
    .content-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-top: 2rem;
    }
    
    .section {
        background: var(--white);
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 3px 10px var(--shadow);
    }
    
    .section h2 {
        color: var(--primary-color);
        margin-bottom: 1.5rem;
        border-bottom: 3px solid var(--accent-color);
        padding-bottom: 0.5rem;
    }
    
    .section-empty {
        color: var(--gray);
        font-style: italic;
        text-align: center;
        padding: 2rem;
        background: var(--light-green);
        border-radius: 8px;
    }
    
    .route-item {
        padding: 1rem;
        background: var(--light-green);
        border-radius: 8px;
        margin-bottom: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .route-item a {
        color: var(--secondary-color);
        text-decoration: none;
        font-weight: 600;
    }
    
    .route-item a:hover {
        text-decoration: underline;
    }
    
    .review-item {
        padding: 1rem;
        border-left: 4px solid var(--accent-color);
        background: var(--light-green);
        margin-bottom: 1rem;
        border-radius: 5px;
    }
    
    .review-item h4 {
        color: var(--primary-color);
        margin-bottom: 0.3rem;
    }
    
    .review-item .rating {
        color: #ffc107;
        font-size: 0.9rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="profile-header">
    <div class="container">
        <div class="profile-info">
            {% if profile_user.profile.avatar %}
                <img src="{{ profile_user.profile.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä" class="profile-avatar">
            {% else %}
                <div class="profile-avatar">üë§</div>
            {% endif %}
            
            <div class="profile-details">
                <h1>{{ profile_user.get_full_name|default:profile_user.username }}</h1>
                <p>@{{ profile_user.username }}</p>
                {% if profile_user.profile.bio %}
                    <p>{{ profile_user.profile.bio }}</p>
                {% endif %}
                <p>–ß–ª–µ–Ω –∑ {{ profile_user.date_joined|date:"d.m.Y" }}</p>
                
                {% if is_own_profile %}
                    <a href="{% url 'profile-edit' %}" class="btn btn-secondary edit-btn">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</a>
                {% endif %}
            </div>
        </div>
        
        <div class="profile-stats">
            <div class="stat-box">
                <div class="stat-number">{{ completed_routes.count }}</div>
                <div class="stat-label">–ü—Ä–æ–π–¥–µ–Ω–∏—Ö –º–∞—Ä—à—Ä—É—Ç—ñ–≤</div>
            </div>
            <div class="stat-box">
                <div class="stat-number">{{ favorite_routes.count }}</div>
                <div class="stat-label">–£–ª—é–±–ª–µ–Ω–∏—Ö</div>
            </div>
            <div class="stat-box">
                <div class="stat-number">{{ user_reviews.count }}</div>
                <div class="stat-label">–í—ñ–¥–≥—É–∫—ñ–≤ –Ω–∞–ø–∏—Å–∞–Ω–æ</div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="content-grid">
        <!-- –ü—Ä–æ–π–¥–µ–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏ -->
        <div class="section">
            <h2>‚úÖ –ü—Ä–æ–π–¥–µ–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏</h2>
            {% if completed_routes %}
                {% for route in completed_routes %}
                    <div class="route-item">
                        <a href="{% url 'route-detail' route.id %}">{{ route.name }}</a>
                        <span style="color: var(--gray); font-size: 0.9rem;">{{ route.height }} –º</span>
                    </div>
                {% endfor %}
            {% else %}
                <div class="section-empty">–©–µ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–æ –∂–æ–¥–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç—É</div>
            {% endif %}
        </div>
        
        <!-- –£–ª—é–±–ª–µ–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏ -->
        <div class="section">
            <h2>‚ù§Ô∏è –£–ª—é–±–ª–µ–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏</h2>
            {% if favorite_routes %}
                {% for route in favorite_routes %}
                    <div class="route-item">
                        <a href="{% url 'route-detail' route.id %}">{{ route.name }}</a>
                        <span style="color: var(--gray); font-size: 0.9rem;">‚≠ê {{ route.get_average_rating|floatformat:1 }}</span>
                    </div>
                {% endfor %}
            {% else %}
                <div class="section-empty">–©–µ –Ω–µ–º–∞—î —É–ª—é–±–ª–µ–Ω–∏—Ö –º–∞—Ä—à—Ä—É—Ç—ñ–≤</div>
            {% endif %}
        </div>
    </div>
    
    <!-- –í—ñ–¥–≥—É–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ -->
    {% if user_reviews %}
        <div class="section" style="margin-top: 2rem;">
            <h2>üí¨ –ù–∞–ø–∏—Å–∞–Ω—ñ –≤—ñ–¥–≥—É–∫–∏</h2>
            {% for review in user_reviews %}
                <div class="review-item">
                    <h4>{{ review.title }}</h4>
                    <p>–ú–∞—Ä—à—Ä—É—Ç: <a href="{% url 'route-detail' review.route.id %}" style="color: var(--secondary-color);">{{ review.route.name }}</a></p>
                    <div class="rating">
                        {% for i in "12345" %}
                            {% if forloop.counter <= review.rating %}‚≠ê{% endif %}
                        {% endfor %}
                    </div>
                    <p style="margin-top: 0.5rem; color: var(--gray); font-size: 0.9rem;">{{ review.text|truncatewords:20 }}</p>
                    <small style="color: var(--gray);">{{ review.created_at|date:"d.m.Y" }}</small>
                </div>
            {% endfor %}
        </div>
    {% endif %}
</div>
{% endblock %}
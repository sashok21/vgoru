{% extends 'mountains_roads/base.html' %}
{% load static %}

{% block title %}–í—Å—ñ –º–∞—Ä—à—Ä—É—Ç–∏ - –ì—ñ—Ä—Å—å–∫—ñ –º–∞—Ä—à—Ä—É—Ç–∏ –£–∫—Ä–∞—ó–Ω–∏{% endblock %}

{% block extra_css %}
<style>
    .filters-section {
        background: var(--light-green);
        padding: 2rem 0;
        margin-bottom: 3rem;
    }
    
    .filters-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
    }
    
    .filter-group {
        display: flex;
        flex-direction: column;
    }
    
    .filter-group label {
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
    }
    
    .filter-group input,
    .filter-group select {
        padding: 0.75rem;
        border: 2px solid #e0e0e0;
        border-radius: 5px;
        font-family: inherit;
    }
    
    .filter-group input:focus,
    .filter-group select:focus {
        outline: none;
        border-color: var(--accent-color);
    }
    
    .filter-buttons {
        display: flex;
        gap: 1rem;
        align-items: flex-end;
    }
    
    .filter-buttons button {
        flex: 1;
    }
    
    .routes-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        gap: 1rem;
    }
    
    .sort-control {
        display: flex;
        gap: 1rem;
        align-items: center;
    }
    
    .sort-control select {
        padding: 0.75rem;
        border: 2px solid var(--secondary-color);
        border-radius: 5px;
        background: var(--white);
        cursor: pointer;
    }
    
    .routes-count {
        color: var(--gray);
        font-size: 0.95rem;
    }
    
    .no-results {
        text-align: center;
        padding: 3rem;
        background: var(--light-green);
        border-radius: 10px;
        color: var(--gray);
    }
    
    .pagination {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        margin-top: 3rem;
    }
    
    .pagination a,
    .pagination span {
        padding: 0.75rem 1rem;
        border: 2px solid var(--secondary-color);
        border-radius: 5px;
        text-decoration: none;
        color: var(--secondary-color);
        transition: all 0.3s ease;
    }
    
    .pagination a:hover,
    .pagination .current {
        background: var(--secondary-color);
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<div style="padding: 2rem 0; background: linear-gradient(rgba(45, 80, 22, 0.5), rgba(45, 80, 22, 0.5)), url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920&q=80') center/cover; color: white; text-align: center;">
    <div class="container">
        <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">–í—Å—ñ –≥—ñ—Ä—Å—å–∫—ñ –º–∞—Ä—à—Ä—É—Ç–∏</h1>
        <p>–ó–Ω–∞–π–¥—ñ—Ç—å —ñ–¥–µ–∞–ª—å–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç –¥–ª—è —Å–≤–æ—î—ó –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –ø—Ä–∏–≥–æ–¥–∏</p>
    </div>
</div>

<!-- –§—ñ–ª—å—Ç—Ä–∏ -->
<div class="filters-section">
    <div class="container">
        <form method="get" id="filterForm">
            <div class="filters-container">
                <div class="filter-group">
                    <label for="search">–ü–æ—à—É–∫</label>
                    <input type="text" id="search" name="search" placeholder="–ù–∞–∑–≤–∞ –º–∞—Ä—à—Ä—É—Ç—É..." value="{{ request.GET.search }}">
                </div>
                
                <div class="filter-group">
                    <label for="difficulty">–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å</label>
                    <select id="difficulty" name="difficulty">
                        <option value="">–í—Å—ñ —Ä—ñ–≤–Ω—ñ</option>
                        {% for value, label in difficulties %}
                            <option value="{{ value }}" {% if request.GET.difficulty == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="region">–†–µ–≥—ñ–æ–Ω</label>
                    <select id="region" name="region">
                        <option value="">–í—Å—ñ —Ä–µ–≥—ñ–æ–Ω–∏</option>
                        {% for r in regions %}
                            <option value="{{ r }}" {% if request.GET.region == r %}selected{% endif %}>{{ r }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="min_height">–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –≤–∏—Å–æ—Ç–∞ (–º)</label>
                    <input type="number" id="min_height" name="min_height" placeholder="0" value="{{ request.GET.min_height }}">
                </div>
                
                <div class="filter-group">
                    <label for="max_height">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –≤–∏—Å–æ—Ç–∞ (–º)</label>
                    <input type="number" id="max_height" name="max_height" placeholder="2500" value="{{ request.GET.max_height }}">
                </div>
            </div>
            
            <div class="filter-buttons" style="margin-top: 1.5rem;">
                <button type="submit" class="btn btn-primary">üîç –§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏</button>
                <a href="{% url 'routes-list' %}" class="btn btn-secondary">–û—á–∏—Å—Ç–∏—Ç–∏</a>
            </div>
        </form>
    </div>
</div>

<!-- –°–ø–∏—Å–æ–∫ –º–∞—Ä—à—Ä—É—Ç—ñ–≤ -->
<div class="container">
    {% if routes %}
        <div class="routes-header">
            <span class="routes-count">–ó–Ω–∞–π–¥–µ–Ω–æ: <strong>{{ paginator.count }}</strong> –º–∞—Ä—à—Ä—É—Ç—ñ–≤</span>
            <div class="sort-control">
                <label for="sort" style="color: var(--primary-color); font-weight: 600;">–°–æ—Ä—Ç—É–≤–∞—Ç–∏:</label>
                <form method="get" style="display: flex; gap: 0.5rem;">
                    <select name="sort" id="sort" onchange="this.form.submit()">
                        <option value="-rating" {% if request.GET.sort == '-rating' or not request.GET.sort %}selected{% endif %}>–ó–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–º ‚Üì</option>
                        <option value="rating" {% if request.GET.sort == 'rating' %}selected{% endif %}>–ó–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–º ‚Üë</option>
                        <option value="name" {% if request.GET.sort == 'name' %}selected{% endif %}>–ó–∞ –Ω–∞–∑–≤–æ—é A-Z</option>
                        <option value="-name" {% if request.GET.sort == '-name' %}selected{% endif %}>–ó–∞ –Ω–∞–∑–≤–æ—é Z-A</option>
                        <option value="height" {% if request.GET.sort == 'height' %}selected{% endif %}>–ó–∞ –≤–∏—Å–æ—Ç–æ—é ‚Üì</option>
                        <option value="-height" {% if request.GET.sort == '-height' %}selected{% endif %}>–ó–∞ –≤–∏—Å–æ—Ç–æ—é ‚Üë</option>
                    </select>
                </form>
            </div>
        </div>

        <div class="routes-grid">
            {% for route in routes %}
                <div class="route-card">
                    <div class="route-image" style="background-image: url('{{ route.image.url }}');">
                        <div class="route-badge">
                            {% if route.difficulty == 'easy' %}üü¢ –õ–µ–≥–∫–∞
                            {% elif route.difficulty == 'medium' %}üü° –°–µ—Ä–µ–¥–Ω—è
                            {% else %}üî¥ –í–∞–∂–∫–∞{% endif %}
                        </div>
                    </div>
                    <div class="route-content">
                        <h3 class="route-title">{{ route.name }}</h3>
                        <div class="route-meta">
                            <span>üìç {{ route.height }} –º</span>
                            <span>‚è±Ô∏è {{ route.duration_hours|floatformat:1 }} –≥–æ–¥</span>
                        </div>
                        <div class="route-meta">
                            <span>{{ route.region }}</span>
                            <span>‚≠ê {{ route.get_average_rating|floatformat:1 }}</span>
                        </div>
                        <p class="route-description">{{ route.description|truncatewords:20 }}</p>
                        <a href="{% url 'route-detail' route.id %}" class="btn btn-primary">–î–µ—Ç–∞–ª—å–Ω—ñ—à–µ</a>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è -->
        {% if is_paginated %}
            <div class="pagination">
                {% if page_obj.has_previous %}
                    <a href="?page=1{% if request.GET.items %}&{{ request.GET.urlencode }}{% endif %}">¬´ –ü–µ—Ä—à–∞</a>
                    <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.items %}&{{ request.GET.urlencode }}{% endif %}">‚Äπ –ü–æ–ø–µ—Ä–µ–¥–Ω—è</a>
                {% endif %}

                {% for num in page_obj.paginator.page_range %}
                    {% if page_obj.number == num %}
                        <span class="current">{{ num }}</span>
                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                        <a href="?page={{ num }}{% if request.GET.items %}&{{ request.GET.urlencode }}{% endif %}">{{ num }}</a>
                    {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}{% if request.GET.items %}&{{ request.GET.urlencode }}{% endif %}">–ù–∞—Å—Ç—É–ø–Ω–∞ ‚Ä∫</a>
                    <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.items %}&{{ request.GET.urlencode }}{% endif %}">–û—Å—Ç–∞–Ω–Ω—è ¬ª</a>
                {% endif %}
            </div>
        {% endif %}
    {% else %}
        <div class="no-results">
            <h2>üòî –ú–∞—Ä—à—Ä—É—Ç—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</h2>
            <p>–°–ø—Ä–æ–±—É–π—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ñ—ñ–ª—å—Ç—Ä–∞</p>
            <a href="{% url 'routes-list' %}" class="btn btn-primary" style="margin-top: 1rem;">–ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ –º–∞—Ä—à—Ä—É—Ç–∏</a>
        </div>
    {% endif %}
</div>

<style>
    {% include 'mountains_roads/css/styles.css' %}
</style>
{% endblock %}